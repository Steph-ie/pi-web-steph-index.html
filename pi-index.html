<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pi</title>
  <meta name="description" content="Pi: learn, calculate, see applications, explore shapes, read papers, and play games ‚Äî in a purple universe." />
  <style>
    :root{
      --bg:#0b0620;
      --bg2:#13083a;
      --card:#1a0c4f;
      --card2:#221067;
      --text:#efeaff;
      --muted:#c9bfff;
      --accent:#a78bfa;
      --accent2:#7c3aed;
      --good:#a7f3d0;
      --bad:#fecaca;
      --shadow: 0 14px 40px rgba(0,0,0,.35);
      --r: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 15% 10%, rgba(167,139,250,.25), transparent 55%),
        radial-gradient(900px 600px at 90% 20%, rgba(124,58,237,.22), transparent 60%),
        radial-gradient(800px 600px at 70% 90%, rgba(167,139,250,.14), transparent 65%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      min-height:100vh;
      line-height:1.45;
    }
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    .wrap{max-width:1120px; margin:0 auto; padding:26px 18px 44px}
    header{
      display:flex; gap:14px; align-items:center; justify-content:space-between;
      padding:14px 16px; border:1px solid rgba(255,255,255,.12); border-radius:var(--r);
      background:rgba(26,12,79,.6); box-shadow:var(--shadow);
      position:sticky; top:10px; backdrop-filter: blur(10px); z-index:10;
    }
    .brand{display:flex; align-items:center; gap:12px}
    .logo{
      width:44px; height:44px; border-radius:14px;
      background: conic-gradient(from 220deg, var(--accent2), var(--accent), #22d3ee, var(--accent2));
      box-shadow: 0 10px 26px rgba(124,58,237,.25);
      display:grid; place-items:center;
      font-weight:800;
    }
    .brand h1{margin:0; font-size:18px; letter-spacing:.3px}
    .brand p{margin:0; color:var(--muted); font-size:12px}
    nav{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end}
    .chip{
      border:1px solid rgba(255,255,255,.16);
      background:rgba(19,8,58,.45);
      padding:8px 10px; border-radius:999px;
      font-size:13px; color:var(--text);
      cursor:pointer; user-select:none;
    }
    .chip:hover{border-color: rgba(167,139,250,.55)}
    .hero{
      margin-top:18px;
      padding:20px 18px;
      border-radius: calc(var(--r) + 8px);
      border:1px solid rgba(255,255,255,.12);
      background: linear-gradient(135deg, rgba(34,16,103,.55), rgba(26,12,79,.25));
      box-shadow: var(--shadow);
    }
    .hero-grid{display:grid; grid-template-columns: 1.1fr .9fr; gap:16px; align-items:stretch}
    .hero h2{margin:0 0 8px; font-size:30px; line-height:1.1}
    .hero .sub{color:var(--muted); margin:0 0 14px; font-size:14px}
    .quick{display:flex; gap:10px; flex-wrap:wrap}
    .btn{
      border:none; cursor:pointer;
      background: linear-gradient(135deg, var(--accent2), var(--accent));
      color: #0b0620;
      font-weight:800;
      padding:10px 12px; border-radius: 12px;
      box-shadow: 0 12px 26px rgba(167,139,250,.22);
    }
    .btn.secondary{
      background: rgba(19,8,58,.35);
      color: var(--text);
      border:1px solid rgba(255,255,255,.14);
      box-shadow:none;
    }
    .statcard{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(26,12,79,.45);
      border-radius: calc(var(--r) + 6px);
      padding:14px;
      display:grid;
      grid-template-rows:auto 1fr auto;
      gap:10px;
    }
    .statrow{display:flex; gap:10px; flex-wrap:wrap}
    .pill{
      border:1px solid rgba(255,255,255,.14);
      border-radius:999px;
      padding:6px 10px;
      font-size:12px;
      color:var(--muted);
      background: rgba(11,6,32,.35);
    }
    .mono{font-family:var(--mono)}
    .cards{
      margin-top:18px;
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:14px;
    }
    .card{
      grid-column: span 4;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(26,12,79,.48);
      border-radius: var(--r);
      padding:14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.22);
      display:flex; flex-direction:column; gap:10px;
    }
    .card h3{margin:0; font-size:16px}
    .card p{margin:0; color:var(--muted); font-size:13px}
    .card .go{
      margin-top:auto;
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
    }
    .go .linkbtn{
      width:100%;
      background: rgba(19,8,58,.42);
      border:1px solid rgba(255,255,255,.14);
      padding:10px 12px;
      border-radius: 12px;
      cursor:pointer;
      color: var(--text);
      font-weight:700;
      text-align:left;
    }
    .go .linkbtn:hover{border-color: rgba(167,139,250,.55)}
    main{margin-top:18px}
    section{
      margin-top:18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(26,12,79,.42);
      border-radius: calc(var(--r) + 8px);
      padding:18px;
      box-shadow: var(--shadow);
    }
    section h2{margin:0 0 10px; font-size:20px}
    .grid2{display:grid; grid-template-columns: 1fr 1fr; gap:14px; align-items:start}
    .grid3{display:grid; grid-template-columns: repeat(3, 1fr); gap:14px; align-items:start}
    .box{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(19,8,58,.35);
      border-radius: var(--r);
      padding:14px;
    }
    .box h4{margin:0 0 6px; font-size:14px}
    .box p{margin:0; color:var(--muted); font-size:13px}
    textarea,input,select{
      width:100%;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(11,6,32,.45);
      color: var(--text);
      padding:10px 12px;
      outline:none;
      font-family: var(--sans);
      font-size:14px;
    }
    textarea{min-height:100px; resize:vertical; font-family:var(--mono); font-size:13px}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .row > *{flex:1 1 180px}
    .small{font-size:12px; color:var(--muted)}
    .kbd{font-family:var(--mono); font-size:12px; padding:2px 6px; border:1px solid rgba(255,255,255,.14); border-radius:8px; background:rgba(11,6,32,.35)}
    .tag{
      display:inline-flex; align-items:center; gap:6px;
      font-size:12px; color:var(--muted);
      border:1px solid rgba(255,255,255,.14);
      background: rgba(11,6,32,.28);
      padding:6px 10px; border-radius:999px;
      margin: 4px 6px 0 0;
    }
    .hr{height:1px; background: rgba(255,255,255,.12); margin:12px 0}
    .digits{
      font-family: var(--sans);
      font-size:14px;
      color: var(--text);
      line-height:1.6;
      padding:12px;
      border-radius: var(--r);
      border:1px solid rgba(255,255,255,.12);
      background: rgba(11,6,32,.35);
      max-height: 240px;
      overflow:auto;
      word-break: break-word;
    }
    .digits .muted{color: var(--muted)}
    .note{
      border-left:4px solid rgba(167,139,250,.7);
      padding:10px 12px; background: rgba(19,8,58,.25);
      border-radius: 12px;
      color: var(--muted);
      font-size:13px;
    }
    .canvaswrap{border-radius: var(--r); overflow:hidden; border:1px solid rgba(255,255,255,.12)}
    canvas{display:block; width:100%; height:320px; background: rgba(11,6,32,.45)}
    .score{
      font-family: var(--mono);
      border:1px solid rgba(255,255,255,.14);
      background: rgba(11,6,32,.35);
      border-radius: 12px;
      padding:10px 12px;
    }
    .ok{color: var(--good)}
    .no{color: var(--bad)}
    .wronglist{margin:10px 0 0; padding:0; list-style:none}
    .wronglist li{margin:6px 0; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background: rgba(11,6,32,.35)}
    footer{margin-top:18px; color: var(--muted); font-size:12px; text-align:center}
    @media (max-width: 980px){
      .hero-grid{grid-template-columns: 1fr}
      .card{grid-column: span 6}
      .grid3{grid-template-columns: 1fr}
      canvas{height:280px}
    }
    @media (max-width: 640px){
      header{flex-direction:column; align-items:stretch}
      nav{justify-content:flex-start}
      .card{grid-column: span 12}
      .grid2{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">œÄ</div>
        <div>
          <h1>Pi</h1>
          <p>A purple home for circles, digits, curves, and small brain games.</p>
        </div>
      </div>
      <nav>
        <div class="chip" data-jump="overview">Overview</div>
        <div class="chip" data-jump="what">What is œÄ</div>
        <div class="chip" data-jump="calculate">Calculate</div>
        <div class="chip" data-jump="applications">Applications</div>
        <div class="chip" data-jump="shapes">Shapes</div>
        <div class="chip" data-jump="papers">Papers</div>
        <div class="chip" data-jump="games">Games</div>
      </nav>
    </header>

    <div class="hero" id="overview">
      <div class="hero-grid">
        <div>
          <h2>Meet œÄ, the number that refuses to end.</h2>
          <p class="sub">
            This page is designed to be readable, playful, and not a vertical wall of doom.
            Click sections, try calculators, explore curves, and play two games.
          </p>
          <div class="quick">
            <button class="btn" onclick="jumpTo('calculate')">Start calculating</button>
            <button class="btn secondary" onclick="jumpTo('games')">Play games</button>
            <button class="btn secondary" onclick="jumpTo('what')">See digits in words</button>
          </div>
          <div class="hr"></div>
          <div class="row">
            <div class="pill">Theme: purple</div>
            <div class="pill">Numbers: natural language</div>
            <div class="pill">Offline-friendly visuals</div>
          </div>
        </div>
        <div class="statcard">
          <div class="statrow">
            <span class="pill">œÄ ‚âà <span class="mono">3.1415926535‚Ä¶</span></span>
            <span class="pill">Circle ratio</span>
            <span class="pill">Irrational</span>
          </div>
          <div class="note">
            Think of œÄ as a translator between circles and straight lines:
            <span class="mono">circumference = pi √ó diameter</span>.
          </div>
          <div class="small">
            Tip: Use the chips in the top bar to jump around. Your ‚Äúwrong answers‚Äù from the quiz are saved locally in your browser.
          </div>
        </div>
      </div>
    </div>

    <div class="cards" aria-label="main cards">
      <div class="card">
        <h3>What is œÄ?</h3>
        <p>Definition, facts, and a long list of digits written out as words.</p>
        <div class="go"><button class="linkbtn" onclick="jumpTo('what')">Open ‚ÄúWhat is œÄ‚Äù ‚Üí</button></div>
      </div>
      <div class="card">
        <h3>Calculate</h3>
        <p>Use a circle calculator, a Monte Carlo simulation, and a series approximation.</p>
        <div class="go"><button class="linkbtn" onclick="jumpTo('calculate')">Open ‚ÄúCalculate‚Äù ‚Üí</button></div>
      </div>
      <div class="card">
        <h3>Applications</h3>
        <p>Photos (as mini illustrations), visuals, and real-world explanations.</p>
        <div class="go"><button class="linkbtn" onclick="jumpTo('applications')">Open ‚ÄúApplications‚Äù ‚Üí</button></div>
      </div>
      <div class="card">
        <h3>Shapes</h3>
        <p>Interactive curves that use œÄ: circle, spiral, sine wave, and cycloid.</p>
        <div class="go"><button class="linkbtn" onclick="jumpTo('shapes')">Open ‚ÄúShapes‚Äù ‚Üí</button></div>
      </div>
      <div class="card">
        <h3>Papers</h3>
        <p>A curated reading shelf of classic and modern œÄ computation papers.</p>
        <div class="go"><button class="linkbtn" onclick="jumpTo('papers')">Open ‚ÄúPapers‚Äù ‚Üí</button></div>
      </div>
      <div class="card">
        <h3>Games</h3>
        <p>Memory game + a ‚Äúnext digit‚Äù game, plus a natural-language quiz.</p>
        <div class="go"><button class="linkbtn" onclick="jumpTo('games')">Open ‚ÄúGames‚Äù ‚Üí</button></div>
      </div>
    </div>

    <main>
      <section id="what">
        <h2>What is œÄ</h2>
        <div class="grid2">
          <div class="box">
            <h4>Definition (in plain language)</h4>
            <p>
              œÄ is the constant ratio between a circle‚Äôs circumference and its diameter.
              No matter how big or tiny the circle is, this ratio stays the same.
            </p>
            <div class="hr"></div>
            <div class="row">
              <span class="tag">circumference equals pi times diameter</span>
              <span class="tag">irrational: never ends, never repeats</span>
              <span class="tag">also shows up in waves and probability</span>
            </div>
          </div>
          <div class="box">
            <h4>Digits (written in natural language)</h4>
            <p class="small">Below is œÄ written as words (first two thousand digits). Choose how many you want to show.</p>
            <div class="row" style="margin-top:10px">
              <select id="digitAmount" aria-label="digit amount">
                <option value="120">one hundred twenty digits</option>
                <option value="300">three hundred digits</option>
                <option value="600">six hundred digits</option>
                <option value="1000">one thousand digits</option>
                <option value="2000" selected>two thousand digits</option>
              </select>
              <button class="btn secondary" onclick="renderDigits()">Render</button>
              <button class="btn secondary" onclick="copyNumeric()">Copy numeric digits</button>
            </div>
            <div id="digitsWords" class="digits" style="margin-top:10px"></div>
            <p class="small muted">Natural language note: ‚Äúthree point one four‚Ä¶‚Äù uses ‚Äúpoint‚Äù for the decimal dot.</p>
          </div>
        </div>
      </section>

      <section id="calculate">
        <h2>Calculate œÄ</h2>
        <p class="small">
          Three ways, three vibes. Use whichever makes your brain feel most at home.
        </p>
        <div class="grid3">
          <div class="box">
            <h4>Method one: Circle measurement</h4>
            <p>Enter circumference and diameter. The calculator returns œÄ as words and as a number.</p>
            <div class="row" style="margin-top:10px">
              <input id="circ" type="number" step="any" placeholder="circumference (for example, 31.4)" />
              <input id="diam" type="number" step="any" placeholder="diameter (for example, 10)" />
            </div>
            <div class="row" style="margin-top:10px">
              <button class="btn" onclick="calcFromMeasure()">Calculate</button>
              <button class="btn secondary" onclick="fillExample()">Use example</button>
            </div>
            <div id="measureOut" class="note" style="margin-top:10px"></div>
          </div>

          <div class="box">
            <h4>Method two: Monte Carlo ‚Äúdartboard‚Äù</h4>
            <p>Random points in a square. Count how many land inside the quarter circle.</p>
            <div class="row" style="margin-top:10px">
              <input id="mcPoints" type="number" min="100" step="100" value="20000" />
              <button class="btn" onclick="runMonteCarlo()">Run</button>
              <button class="btn secondary" onclick="runMonteCarlo(true)">Animate</button>
            </div>
            <div id="mcOut" class="note" style="margin-top:10px"></div>
            <div class="small" style="margin-top:8px">
              Formula: pi is about four times (points inside) divided by (total points).
            </div>
          </div>

          <div class="box">
            <h4>Method three: Leibniz series</h4>
            <p>Slow but poetic: œÄ equals four times (one minus one third plus one fifth minus one seventh ‚Ä¶).</p>
            <div class="row" style="margin-top:10px">
              <input id="terms" type="number" min="10" step="10" value="5000" />
              <button class="btn" onclick="runLeibniz()">Approximate</button>
            </div>
            <div id="seriesOut" class="note" style="margin-top:10px"></div>
          </div>
        </div>
      </section>

      <section id="applications">
        <h2>Applications of œÄ</h2>
        <p class="small">Mini ‚Äúphotos‚Äù as illustrations (so the site works offline) + quick explanations.</p>
        <div class="grid3" style="margin-top:12px">
          <div class="box">
            <h4>Engineering: wheels and gears</h4>
            <svg viewBox="0 0 240 140" width="100%" height="120" role="img" aria-label="wheel illustration">
              <defs>
                <radialGradient id="g1" cx="35%" cy="30%">
                  <stop offset="0%" stop-color="rgba(167,139,250,.9)"/>
                  <stop offset="100%" stop-color="rgba(124,58,237,.25)"/>
                </radialGradient>
              </defs>
              <rect x="0" y="0" width="240" height="140" rx="18" fill="rgba(11,6,32,.35)" stroke="rgba(255,255,255,.12)"/>
              <circle cx="82" cy="70" r="44" fill="url(#g1)" stroke="rgba(255,255,255,.18)" />
              <circle cx="82" cy="70" r="8" fill="rgba(11,6,32,.6)" stroke="rgba(255,255,255,.22)"/>
              <circle cx="155" cy="70" r="30" fill="rgba(124,58,237,.28)" stroke="rgba(255,255,255,.18)" />
              <circle cx="155" cy="70" r="6" fill="rgba(11,6,32,.6)" stroke="rgba(255,255,255,.22)"/>
              <path d="M122 70 L125 70" stroke="rgba(255,255,255,.3)" stroke-width="10" stroke-linecap="round"/>
            </svg>
            <p>
              Any time something rotates, œÄ sneaks in. Distance traveled by a wheel is related to its circumference,
              which is pi times diameter.
            </p>
          </div>

          <div class="box">
            <h4>Physics: waves and Fourier</h4>
            <svg viewBox="0 0 240 140" width="100%" height="120" role="img" aria-label="wave illustration">
              <rect x="0" y="0" width="240" height="140" rx="18" fill="rgba(11,6,32,.35)" stroke="rgba(255,255,255,.12)"/>
              <path id="wavePath" d="" fill="none" stroke="rgba(167,139,250,.9)" stroke-width="4" />
              <path d="M20 70 H220" stroke="rgba(255,255,255,.16)" />
              <text x="18" y="22" fill="rgba(255,255,255,.55)" font-size="12" font-family="ui-monospace, monospace">two pi radians = one full turn</text>
            </svg>
            <p>
              Angles in physics often use radians. One full rotation equals two pi radians, so periodic motion naturally involves œÄ.
            </p>
          </div>

          <div class="box">
            <h4>Probability: the normal distribution</h4>
            <svg viewBox="0 0 240 140" width="100%" height="120" role="img" aria-label="bell curve illustration">
              <rect x="0" y="0" width="240" height="140" rx="18" fill="rgba(11,6,32,.35)" stroke="rgba(255,255,255,.12)"/>
              <path d="M20 120 C 55 120, 70 30, 120 30 C 170 30, 185 120, 220 120" fill="none" stroke="rgba(124,58,237,.9)" stroke-width="4"/>
              <path d="M20 120 H220" stroke="rgba(255,255,255,.16)"/>
              <text x="18" y="22" fill="rgba(255,255,255,.55)" font-size="12" font-family="ui-monospace, monospace">one over square root of two pi</text>
            </svg>
            <p>
              The famous bell curve includes a normalizing constant with œÄ.
              Geometry and probability share a secret handshake.
            </p>
          </div>
        </div>

        <div class="hr"></div>
        <div class="grid2">
          <div class="box">
            <h4>Architecture and design</h4>
            <p>
              Arches, domes, pipes, fountains, and anything circular uses œÄ in measurements:
              areas, perimeters, volumes, and scaling.
            </p>
          </div>
          <div class="box">
            <h4>Computing</h4>
            <p>
              œÄ is used to stress-test big-number arithmetic, verify hardware reliability, and benchmark algorithms.
              It‚Äôs a mathematically famous ‚Äúendurance run.‚Äù
            </p>
          </div>
        </div>
      </section>

      <section id="shapes">
        <h2>Shapes powered by œÄ</h2>
        <p class="small">Choose a curve. The canvas redraws with a formula that uses œÄ (or is naturally expressed in radians).</p>

        <div class="row" style="margin-top:10px">
          <select id="shapeSelect" aria-label="shape selector" onchange="drawShape()">
            <option value="circle">circle</option>
            <option value="spiral">archimedean spiral</option>
            <option value="sine">sine wave (in radians)</option>
            <option value="cycloid">cycloid (rolling circle)</option>
          </select>
          <button class="btn secondary" onclick="drawShape()">Redraw</button>
          <div class="score" id="shapeFormula">formula appears here</div>
        </div>

        <div class="canvaswrap" style="margin-top:12px">
          <canvas id="shapeCanvas" width="1000" height="500"></canvas>
        </div>

        <div class="note" style="margin-top:12px">
          If angles are in radians, œÄ becomes the ruler: pi is one half-turn, two pi is a full turn.
        </div>
      </section>

      <section id="papers">
        <h2>Papers and further reading</h2>
        <p class="small">
          This is a curated shelf (hand-picked). To ‚Äúupdate by time,‚Äù edit the list in the page code or add new items.
        </p>

        <div class="grid2" style="margin-top:12px">
          <div class="box">
            <h4>Classic computation milestones</h4>
            <ul class="small" style="margin:8px 0 0; padding-left:18px; color:var(--muted)">
              <li><a href="https://arxiv.org/abs/1004.3412" target="_blank" rel="noreferrer">Brent (1976, later survey) on the Gauss-Legendre / Brent-Salamin approach</a></li>
              <li><a href="https://en.wikipedia.org/wiki/Gauss%E2%80%93Legendre_algorithm" target="_blank" rel="noreferrer">Gauss-Legendre algorithm overview (fast convergence)</a></li>
              <li><a href="https://en.wikipedia.org/wiki/Chudnovsky_algorithm" target="_blank" rel="noreferrer">Chudnovsky algorithm overview (record computations)</a></li>
            </ul>
            <div class="hr"></div>
            <p class="small">Want a quick reading plan? Start with the overviews, then open Brent‚Äôs arXiv survey.</p>
          </div>

          <div class="box">
            <h4>Modern ‚Äúdigit extraction‚Äù and series proofs</h4>
            <ul class="small" style="margin:8px 0 0; padding-left:18px; color:var(--muted)">
              <li><a href="https://en.wikipedia.org/wiki/Bailey%E2%80%93Borwein%E2%80%93Plouffe_formula" target="_blank" rel="noreferrer">BBP formula (hex digit extraction idea)</a></li>
              <li><a href="https://digital.library.unt.edu/ark%3A/67531/metadc1013585/" target="_blank" rel="noreferrer">UNT note: BBP algorithm explanation</a></li>
              <li><a href="https://arxiv.org/abs/1807.07394" target="_blank" rel="noreferrer">Guillera (2018): method for proving Ramanujan series for one over pi</a></li>
              <li><a href="https://arxiv.org/abs/1609.05778" target="_blank" rel="noreferrer">Chen &amp; Glebov (2016): Chudnovsky-Ramanujan type formulae</a></li>
            </ul>
          </div>
        </div>

        <div class="hr"></div>
        <div class="note">
          Citation note: these links are real, but they are not automatically refreshed. If you want a ‚Äúlatest updates‚Äù feed,
          you can host this as a small site and load a JSON file that you update over time.
        </div>
      </section>

      <section id="games">
        <h2>Games (and a quiz) üéÆ</h2>
        <p class="small">Two games plus a quiz. Your quiz mistakes get saved in your browser (local storage) so you can review.</p>

        <div class="grid2" style="margin-top:12px">
          <div class="box">
            <h4>Game one: Memory match</h4>
            <p>
              Match pairs. Cards contain small œÄ facts written in normal language.
              When you win, the board regenerates with a new shuffle.
            </p>
            <div class="row" style="margin-top:10px">
              <select id="memSize" aria-label="memory size">
                <option value="8">eight cards</option>
                <option value="12" selected>twelve cards</option>
                <option value="16">sixteen cards</option>
              </select>
              <button class="btn" onclick="startMemory()">Start</button>
            </div>
            <div id="memBoard" style="margin-top:12px; display:grid; grid-template-columns: repeat(4, 1fr); gap:10px;"></div>
            <div class="row" style="margin-top:10px">
              <div class="score" id="memScore">moves: zero</div>
              <div class="score" id="memStatus">status: ready</div>
            </div>
          </div>

          <div class="box">
            <h4>Game two: Next digit (in words)</h4>
            <p>
              You get a short prefix of œÄ in words. Choose the next digit-word from three options.
              It‚Äôs like feeding a dragon one correct snack at a time.
            </p>
            <div class="row" style="margin-top:10px">
              <button class="btn" onclick="startNextDigit()">Start / restart</button>
              <div class="score">score: <span id="ndScore">zero</span></div>
            </div>
            <div class="note" id="ndPrompt" style="margin-top:10px">Press start.</div>
            <div class="row" style="margin-top:10px">
              <button class="btn secondary" id="ndA" onclick="chooseND(0)" disabled>option A</button>
              <button class="btn secondary" id="ndB" onclick="chooseND(1)" disabled>option B</button>
              <button class="btn secondary" id="ndC" onclick="chooseND(2)" disabled>option C</button>
            </div>
            <div class="small" style="margin-top:10px">Hint: the correct next word is always one of the three.</div>
          </div>
        </div>

        <div class="hr"></div>

        <div class="box">
          <h4>Quiz (natural language) + ‚Äúmistakes I made‚Äù</h4>
          <p class="small">
            Answer in natural language style. You can retry.
          </p>
          <div id="quizBox" style="margin-top:10px"></div>
          <div class="row" style="margin-top:10px">
            <button class="btn" onclick="gradeQuiz()">Grade</button>
            <button class="btn secondary" onclick="resetQuiz()">Reset quiz</button>
            <button class="btn secondary" onclick="clearMistakes()">Clear mistake list</button>
          </div>
          <div id="quizOut" class="note" style="margin-top:10px"></div>
          <div class="hr"></div>
          <h4 style="margin:0 0 6px">Questions I got wrong (saved)</h4>
          <ul id="wrongList" class="wronglist"></ul>
        </div>
      </section>
    </main>

    <footer>
      Built as a single-file website. You can host it on GitHub Pages to get a public link.
    </footer>
  </div>

<script>
/* ---------- navigation ---------- */
function jumpTo(id){
  const el = document.getElementById(id);
  if(!el) return;
  el.scrollIntoView({behavior:'smooth', block:'start'});
}
document.querySelectorAll('[data-jump]').forEach(chip => {
  chip.addEventListener('click', () => jumpTo(chip.dataset.jump));
});

/* ---------- pi digits (hardcoded) ---------- */
const PI_NUMERIC = "3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632788659361533818279682303019520353018529689957736225994138912497217752834791315155748572424541506959508295331168617278558890750983817546374649393192550604009277016711390098488240128583616035637076601047101819429555961989467678374494482553797747268471040475346462080466842590694912933136770289891521047521620569660240580381501935112533824300355876402474964732639141992726042699227967823547816360093417216412199245863150302861829745557067498385054945885869269956909272107975093029553211653449872027559602364806654991198818347977535663698074265425278625518184175746728909777727938000816470600161452491921732172147723501414419735685481613611573525521334757418494684385233239073941433345477624168625189835694855620992192221842725502542568876717904946016534668049886272327917860857843838279679766814541009538837863609506800642251252051173929848960841284886269456042419652850222106611863067442786220391949450471237137869609563643719172874677646575739624138908658326459958133904780275900994"; // 3 . and 2000 digits after decimal

const DIGIT_WORD = {
  "0":"zero","1":"one","2":"two","3":"three","4":"four",
  "5":"five","6":"six","7":"seven","8":"eight","9":"nine"
};

function piWords(nDigitsAfter){
  // returns "three point one four ...", limited to nDigitsAfter digits after decimal
  const s = PI_NUMERIC;
  const parts = s.split('.');
  const intPart = parts[0] || "3";
  const dec = (parts[1] || "").slice(0, nDigitsAfter);

  const words = [];
  for (const ch of intPart) words.push(DIGIT_WORD[ch] ?? ch);
  words.push("point");

  // group words for readability
  const group = [];
  for (let i=0; i<dec.length; i++){
    group.push(DIGIT_WORD[dec[i]]);
    if ((i+1) % 3 === 0) group.push(" ¬∑ ");
    if ((i+1) % 30 === 0) group.push("\n");
  }
  return words.join(" ") + " " + group.join(" ");
}

function renderDigits(){
  const amt = parseInt(document.getElementById('digitAmount').value, 10);
  const out = document.getElementById('digitsWords');
  const w = piWords(amt).replaceAll(" \n ", "\n").replaceAll("\n", "<br>");
  out.innerHTML = w;
}

function copyNumeric(){
  navigator.clipboard.writeText(PI_NUMERIC).then(() => {
    toast("Copied numeric digits of pi.");
  }).catch(() => {
    alert("Copy failed. Your browser may block clipboard access.");
  });
}

/* ---------- toasts ---------- */
let toastTimer = null;
function toast(msg){
  let t = document.getElementById('toast');
  if(!t){
    t = document.createElement('div');
    t.id = 'toast';
    t.style.position = 'fixed';
    t.style.left = '18px';
    t.style.bottom = '18px';
    t.style.zIndex = '1000';
    t.style.padding = '10px 12px';
    t.style.borderRadius = '14px';
    t.style.border = '1px solid rgba(255,255,255,.14)';
    t.style.background = 'rgba(19,8,58,.7)';
    t.style.backdropFilter = 'blur(10px)';
    t.style.boxShadow = '0 14px 40px rgba(0,0,0,.35)';
    t.style.color = 'var(--text)';
    t.style.fontSize = '13px';
    document.body.appendChild(t);
  }
  t.textContent = msg;
  t.style.display = 'block';
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=>{ t.style.display='none'; }, 2400);
}

/* ---------- calculate section ---------- */
function asWordsNumber(x){
  if (!isFinite(x)) return "not a finite number";
  // We keep numeric but also provide words for digits and point
  const s = x.toString();
  let out = [];
  for (const ch of s){
    if (DIGIT_WORD[ch]) out.push(DIGIT_WORD[ch]);
    else if (ch === '.') out.push('point');
    else if (ch === '-') out.push('minus');
    else out.push(ch);
  }
  return out.join(' ');
}

function fillExample(){
  document.getElementById('circ').value = 31.4;
  document.getElementById('diam').value = 10;
}

function calcFromMeasure(){
  const c = parseFloat(document.getElementById('circ').value);
  const d = parseFloat(document.getElementById('diam').value);
  const out = document.getElementById('measureOut');
  if(!isFinite(c) || !isFinite(d) || d === 0){
    out.innerHTML = "Please enter a valid circumference and a non-zero diameter.";
    return;
  }
  const pi = c / d;
  out.innerHTML = `
    <div><span class="kbd">pi</span> equals circumference divided by diameter:</div>
    <div class="mono" style="margin-top:6px">${pi.toFixed(12)}</div>
    <div class="small" style="margin-top:6px">in words: ${asWordsNumber(pi.toFixed(12))}</div>
  `;
}

function runLeibniz(){
  const n = Math.max(10, parseInt(document.getElementById('terms').value, 10) || 5000);
  let sum = 0;
  for(let k=0;k<n;k++) {
    const term = 1 / (2*k + 1);
    sum += (k % 2 === 0) ? term : -term;
  }
  const pi = 4 * sum;
  const out = document.getElementById('seriesOut');
  out.innerHTML = `
    <div>Using <span class="kbd">${n.toLocaleString()}</span> terms:</div>
    <div class="mono" style="margin-top:6px">${pi.toFixed(12)}</div>
    <div class="small" style="margin-top:6px">difference from built-in pi: ${Math.abs(pi - Math.PI).toExponential(3)}</div>
  `;
}

let mcAnimating = false;
function runMonteCarlo(animate=false){
  const total = Math.max(100, parseInt(document.getElementById('mcPoints').value, 10) || 20000);
  const out = document.getElementById('mcOut');
  mcAnimating = false;

  if(!animate){
    let inside = 0;
    for(let i=0;i<total;i++) {
      const x = Math.random();
      const y = Math.random();
      if(x*x + y*y <= 1) inside++;
    }
    const pi = 4 * inside / total;
    out.innerHTML = `
      <div>points inside: <span class="kbd">${inside.toLocaleString()}</span> out of <span class="kbd">${total.toLocaleString()}</span></div>
      <div class="mono" style="margin-top:6px">${pi.toFixed(12)}</div>
      <div class="small" style="margin-top:6px">error: ${Math.abs(pi - Math.PI).toExponential(3)}</div>
    `;
    return;
  }

  // animated mode: chunked batches
  mcAnimating = true;
  let inside = 0, done = 0;
  out.innerHTML = "Animating‚Ä¶";
  const batch = 1200;

  function step(){
    if(!mcAnimating) return;
    const n = Math.min(batch, total - done);
    for(let i=0;i<n;i++) {
      const x = Math.random();
      const y = Math.random();
      if(x*x + y*y <= 1) inside++;
    }
    done += n;
    const pi = 4 * inside / done;
    out.innerHTML = `
      <div>progress: <span class="kbd">${done.toLocaleString()}</span> / <span class="kbd">${total.toLocaleString()}</span></div>
      <div>estimate: <span class="mono">${pi.toFixed(12)}</span></div>
      <div class="small">error: ${Math.abs(pi - Math.PI).toExponential(3)}</div>
    `;
    if(done < total) requestAnimationFrame(step);
    else mcAnimating = false;
  }
  requestAnimationFrame(step);
}

/* ---------- applications wave path ---------- */
(function buildWave(){
  const path = document.getElementById('wavePath');
  if(!path) return;
  let d = "";
  const W = 200, H = 80;
  const ox = 20, oy = 70;
  for(let i=0;i<=W;i++) {
    const x = ox + i;
    const t = (i/W) * 2*Math.PI*2; // two full turns
    const y = oy - Math.sin(t) * 30;
    d += (i===0 ? "M" : "L") + x.toFixed(2) + " " + y.toFixed(2) + " ";
  }
  path.setAttribute("d", d.trim());
})();

/* ---------- shapes canvas ---------- */
const canvas = document.getElementById('shapeCanvas');
const ctx = canvas.getContext('2d');

// Make the canvas truly visible on dark backgrounds (high contrast)
// and scale it for retina / high-DPI screens so lines don't look blurry.
function resizeCanvasToDisplaySize(){
  const dpr = window.devicePixelRatio || 1;
  const rect = canvas.getBoundingClientRect();
  const w = Math.max(300, Math.floor(rect.width * dpr));
  const h = Math.max(220, Math.floor(rect.height * dpr));
  if (canvas.width !== w || canvas.height !== h){
    canvas.width = w;
    canvas.height = h;
  }
  ctx.setTransform(1,0,0,1,0,0);
  ctx.scale(dpr, dpr);
}

// Strong stroke color so you can actually SEE the shapes.
function setStroke(style='rgba(167,139,250,.95)', width=3){
  ctx.strokeStyle = style;
  ctx.lineWidth = width;
  ctx.lineCap = 'round';
  ctx.lineJoin = 'round';
}

// Little glow for ‚Äúvirtual‚Äù vibe
function strokeGlow(){
  ctx.save();
  ctx.shadowColor = 'rgba(167,139,250,.55)';
  ctx.shadowBlur = 10;
  ctx.stroke();
  ctx.restore();
}

function clearCanvas(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // faint grid
  ctx.globalAlpha = 0.25;
  ctx.lineWidth = 1;
  for(let x=0;x<=canvas.width;x+=100){
    ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,canvas.height); ctx.stroke();
  }
  for(let y=0;y<=canvas.height;y+=100){
    ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(canvas.width,y); ctx.stroke();
  }
  ctx.globalAlpha = 1;
}

function drawCircle(){
  document.getElementById('shapeFormula').textContent = "circle: x equals r cos t, y equals r sin t, with t from zero to two pi";
  clearCanvas();

  const rect = canvas.getBoundingClientRect();
  const W = rect.width, H = rect.height;
  const cx = W/2, cy = H/2;
  const r = Math.min(W, H)*0.32;

  setStroke('rgba(167,139,250,.95)', 3);

  ctx.beginPath();
  for(let i=0;i<=900;i++){
    const t = (i/900)*Math.PI*2;
    const x = cx + r*Math.cos(t);
    const y = cy + r*Math.sin(t);
    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  }
  strokeGlow();

  // radius indicator
  ctx.save();
  setStroke('rgba(255,255,255,.65)', 2);
  ctx.beginPath(); ctx.moveTo(cx,cy); ctx.lineTo(cx+r, cy); ctx.stroke();
  ctx.restore();

  // label
  ctx.fillStyle = 'rgba(255,255,255,.75)';
  ctx.font = '12px ui-monospace, monospace';
  ctx.fillText('two pi makes a full loop', 14, 22);
}

function drawSpiral(){
  document.getElementById('shapeFormula').textContent = "archimedean spiral: r equals a plus b t, t in radians (pi is the turn-ruler)";
  clearCanvas();

  const rect = canvas.getBoundingClientRect();
  const W = rect.width, H = rect.height;
  const cx = W/2, cy = H/2;

  const a = 0;
  const b = Math.min(W,H) / 35; // adapt to screen size

  setStroke('rgba(124,58,237,.95)', 3);

  ctx.beginPath();
  for(let i=0;i<=2200;i++){
    const t = i/55; // radians
    const r = a + b*t;
    const x = cx + r*Math.cos(t);
    const y = cy + r*Math.sin(t);
    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  }
  strokeGlow();

  ctx.fillStyle = 'rgba(255,255,255,.75)';
  ctx.font = '12px ui-monospace, monospace';
  ctx.fillText('each turn counts in pi', 14, 22);
}

function drawSine(){
  document.getElementById('shapeFormula').textContent = "sine wave: y equals sin x, with x in radians (two pi gives one full cycle)";
  clearCanvas();

  const rect = canvas.getBoundingClientRect();
  const W = rect.width, H = rect.height;

  const pad = 34;
  const x0 = pad, x1 = W - pad;
  const yMid = H/2;
  const amp = H*0.22;
  const cycles = 2.5;

  // axis
  ctx.save();
  setStroke('rgba(255,255,255,.35)', 2);
  ctx.beginPath(); ctx.moveTo(x0,yMid); ctx.lineTo(x1,yMid); ctx.stroke();
  ctx.restore();

  setStroke('rgba(167,139,250,.95)', 3);

  ctx.beginPath();
  for(let i=0;i<=1100;i++){
    const u = i/1100;
    const x = x0 + u*(x1-x0);
    const t = u * (Math.PI*2*cycles);
    const y = yMid - Math.sin(t)*amp;
    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  }
  strokeGlow();

  ctx.fillStyle = 'rgba(255,255,255,.75)';
  ctx.font = '12px ui-monospace, monospace';
  ctx.fillText('two pi = one cycle', 14, 22);
}

function drawCycloid(){
  document.getElementById('shapeFormula').textContent = "cycloid: x equals r (t minus sin t), y equals r (1 minus cos t), t from zero to four pi";
  clearCanvas();

  const rect = canvas.getBoundingClientRect();
  const W = rect.width, H = rect.height;

  const pad = 40;
  const r = Math.min(W,H) * 0.12;
  const yBase = H*0.72;
  const scale = 1.05;

  // baseline
  ctx.save();
  setStroke('rgba(255,255,255,.32)', 2);
  ctx.beginPath(); ctx.moveTo(pad, yBase); ctx.lineTo(W-pad, yBase); ctx.stroke();
  ctx.restore();

  setStroke('rgba(124,58,237,.95)', 3);

  ctx.beginPath();
  const T = 4*Math.PI;
  for(let i=0;i<=1500;i++){
    const t = (i/1500)*T;
    const x = pad + scale * r*(t - Math.sin(t));
    const y = yBase - scale * r*(1 - Math.cos(t));
    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  }
  strokeGlow();

  ctx.fillStyle = 'rgba(255,255,255,.75)';
  ctx.font = '12px ui-monospace, monospace';
  ctx.fillText('rolling circle path', 14, 22);
}

function drawShape(){
  const v = document.getElementById('shapeSelect').value;
  if(v === "circle") drawCircle();
  if(v === "spiral") drawSpiral();
  if(v === "sine") drawSine();
  if(v === "cycloid") drawCycloid();
}

/* ---------- memory game ---------- */
const MEM_FACTS = [
  "pi is about three point one four",
  "a circle's area is pi times radius squared",
  "a circle's circumference is pi times diameter",
  "two pi radians is a full rotation",
  "pi appears in the normal distribution",
  "pi is irrational",
  "pi is also transcendental",
  "pi shows up in Fourier series",
  "pi day is march fourteen",
  "archimedes bracketed pi using polygons",
  "pi is used to test computer hardware",
  "pi hides in spheres and cylinders"
];

let memState = {
  open: [],
  lock: false,
  moves: 0,
  matched: 0,
  totalPairs: 0
};

function startMemory(){
  const n = parseInt(document.getElementById('memSize').value, 10);
  const pairs = Math.floor(n/2);
  memState = {open:[], lock:false, moves:0, matched:0, totalPairs:pairs};
  document.getElementById('memScore').textContent = "moves: zero";
  document.getElementById('memStatus').textContent = "status: playing";

  // pick facts and duplicate
  const pool = [...MEM_FACTS].sort(()=>Math.random()-0.5).slice(0, pairs);
  const cards = [...pool, ...pool].sort(()=>Math.random()-0.5).map((text, idx) => ({
    id: idx,
    text,
    faceUp: false,
    done: false
  }));

  const board = document.getElementById('memBoard');
  const cols = Math.min(4, Math.max(2, Math.ceil(Math.sqrt(n))));
  board.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
  board.innerHTML = "";

  cards.forEach(card => {
    const btn = document.createElement('button');
    btn.className = 'linkbtn';
    btn.style.height = '74px';
    btn.style.textAlign = 'center';
    btn.style.fontWeight = '800';
    btn.style.borderRadius = '16px';
    btn.dataset.id = card.id;
    btn.textContent = "tap";
    btn.addEventListener('click', () => flipCard(card, btn, cards));
    board.appendChild(btn);
  });
}

function flipCard(card, btn, cards){
  if(memState.lock || card.done || card.faceUp) return;
  card.faceUp = true;
  btn.textContent = card.text;
  memState.open.push({card, btn});

  if(memState.open.length === 2){
    memState.moves++;
    document.getElementById('memScore').textContent = "moves: " + memState.moves.toString();
    const [a,b] = memState.open;

    if(a.card.text === b.card.text){
      a.card.done = true; b.card.done = true;
      a.btn.style.borderColor = "rgba(167, 243, 208, .55)";
      b.btn.style.borderColor = "rgba(167, 243, 208, .55)";
      memState.matched++;
      memState.open = [];
      if(memState.matched === memState.totalPairs){
        document.getElementById('memStatus').textContent = "status: win!";
        toast("Memory win. Shuffling a new board.");
        setTimeout(startMemory, 900);
      }
    } else {
      memState.lock = true;
      a.btn.style.borderColor = "rgba(254,202,202,.55)";
      b.btn.style.borderColor = "rgba(254,202,202,.55)";
      setTimeout(()=>{
        a.card.faceUp = false; b.card.faceUp = false;
        a.btn.textContent = "tap"; b.btn.textContent = "tap";
        a.btn.style.borderColor = "rgba(255,255,255,.14)";
        b.btn.style.borderColor = "rgba(255,255,255,.14)";
        memState.open = [];
        memState.lock = false;
      }, 650);
    }
  }
}

/* ---------- next digit game ---------- */
let ndIndex = 0; // index in digits after decimal
let ndScore = 0;
let ndCorrectWord = "";
let ndOptions = [];

function startNextDigit(){
  ndScore = 0;
  ndIndex = 0;
  document.getElementById('ndScore').textContent = "zero";
  nextDigitRound();
}

function nextDigitRound(){
  const dec = PI_NUMERIC.split('.')[1];
  const prefixLen = Math.min(9, ndIndex + 3);
  const prefix = dec.slice(0, prefixLen).split("").map(d => DIGIT_WORD[d]).join(" ");
  const correctDigit = dec[ndIndex];
  ndCorrectWord = DIGIT_WORD[correctDigit];

  // pick two wrong options
  const digits = ["zero","one","two","three","four","five","six","seven","eight","nine"];
  const wrong = digits.filter(w => w !== ndCorrectWord).sort(()=>Math.random()-0.5).slice(0,2);
  ndOptions = [ndCorrectWord, ...wrong].sort(()=>Math.random()-0.5);

  document.getElementById('ndPrompt').innerHTML = `
    <div class="small">Prefix:</div>
    <div style="margin-top:6px">${prefix} <span class="muted">‚Ä¶</span></div>
    <div class="small" style="margin-top:8px">Choose the next digit word:</div>
  `;

  const buttons = [document.getElementById('ndA'), document.getElementById('ndB'), document.getElementById('ndC')];
  buttons.forEach((b, i) => {
    b.disabled = false;
    b.textContent = ndOptions[i];
  });
}

function chooseND(i){
  const choice = ndOptions[i];
  if(choice === ndCorrectWord){
    ndScore++;
    ndIndex++;
    document.getElementById('ndScore').textContent = ndScore.toString();
    toast("Correct.");
    nextDigitRound();
  } else {
    toast("Not that one. The correct word was: " + ndCorrectWord);
    // small penalty: restart round but do not advance
    nextDigitRound();
  }
}

/* ---------- quiz ---------- */
const QUIZ = [
  {
    q: "In plain language, what is pi?",
    options: [
      "the ratio of a circle's circumference to its diameter",
      "the ratio of a circle's radius to its diameter",
      "the square root of two"
    ],
    a: 0
  },
  {
    q: "Which sentence is true?",
    options: [
      "pi ends after a finite number of digits",
      "pi is irrational (it never ends and never repeats)",
      "pi is always equal to three"
    ],
    a: 1
  },
  {
    q: "Which formula gives the area of a circle?",
    options: [
      "pi times radius squared",
      "two pi times radius squared",
      "radius divided by pi"
    ],
    a: 0
  },
  {
    q: "How many radians are in one full rotation?",
    options: [
      "pi radians",
      "two pi radians",
      "four pi radians"
    ],
    a: 1
  },
  {
    q: "In the Monte Carlo method, pi is estimated as:",
    options: [
      "four times (inside points) divided by (total points)",
      "two times (inside points) divided by (total points)",
      "inside points divided by four"
    ],
    a: 0
  },
];

function buildQuiz(){
  const box = document.getElementById('quizBox');
  box.innerHTML = "";
  QUIZ.forEach((item, idx) => {
    const wrap = document.createElement('div');
    wrap.className = 'box';
    wrap.style.marginBottom = '10px';
    wrap.innerHTML = `
      <div style="font-weight:800; margin-bottom:8px">question ${(idx+1).toString()}: ${item.q}</div>
      <div class="row">
        ${item.options.map((opt, j) => `
          <label class="tag" style="cursor:pointer">
            <input type="radio" name="q${idx}" value="${j}" style="width:auto; margin:0 8px 0 0" />
            ${opt}
          </label>
        `).join("")}
      </div>
    `;
    box.appendChild(wrap);
  });
}

function getMistakes(){
  try {
    return JSON.parse(localStorage.getItem("pi_mistakes") || "[]");
  } catch(e) {
    return [];
  }
}

function saveMistakes(arr){
  localStorage.setItem("pi_mistakes", JSON.stringify(arr.slice(0, 50)));
}

function renderMistakes(){
  const list = document.getElementById('wrongList');
  const mistakes = getMistakes();
  list.innerHTML = "";
  if(mistakes.length === 0){
    list.innerHTML = "<li>No saved mistakes yet. (A clean slate.)</li>";
    return;
  }
  mistakes.forEach(m => {
    const li = document.createElement('li');
    li.innerHTML = `
      <div style="font-weight:800">${m.q}</div>
      <div class="small">you chose: <span class="no">${m.chosen}</span></div>
      <div class="small">correct: <span class="ok">${m.correct}</span></div>
    `;
    list.appendChild(li);
  });
}

function gradeQuiz(){
  const out = document.getElementById('quizOut');
  let correct = 0;
  const newMistakes = [];
  QUIZ.forEach((item, idx) => {
    const chosen = document.querySelector(`input[name="q${idx}"]:checked`);
    const chosenIdx = chosen ? parseInt(chosen.value, 10) : -1;
    if(chosenIdx === item.a) correct++;
    else {
      newMistakes.push({
        q: "question " + (idx+1).toString() + ": " + item.q,
        chosen: chosenIdx === -1 ? "no answer" : item.options[chosenIdx],
        correct: item.options[item.a]
      });
    }
  });

  // merge with old mistakes, de-dup by question text
  const old = getMistakes();
  const merged = [...newMistakes, ...old].filter((m, i, arr) =>
    arr.findIndex(x => x.q === m.q) === i
  );
  saveMistakes(merged);

  out.innerHTML = `
    <div>Your score: <span class="kbd">${correct.toString()}</span> out of <span class="kbd">${QUIZ.length.toString()}</span>.</div>
    <div class="small" style="margin-top:6px">${newMistakes.length ? "Mistakes saved below." : "No mistakes to save. Nice."}</div>
  `;
  renderMistakes();
}

function resetQuiz(){
  document.querySelectorAll('#quizBox input[type="radio"]').forEach(x => x.checked = false);
  document.getElementById('quizOut').textContent = "Quiz reset.";
}

function clearMistakes(){
  localStorage.removeItem("pi_mistakes");
  toast("Cleared mistake list.");
  renderMistakes();
}

/* ---------- init ---------- */
renderDigits();
drawShape();
window.addEventListener('resize', () => { drawShape(); });
buildQuiz();
renderMistakes();
</script>
</body>
</html>
